<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Component Status Checklist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>

<body>
    <section>
        <div class="container mt-3">
            <div class="card border-dark">
                <div class="card-header text-center bg-dark text-white">
                    Failed Parts Details
                </div>
                <div class="card-body" id="inputContainer">
                    <div class="form-group">
                        <label class="form-control border-black">Uee Part No</label>
                        <input type="text" class="form-control border-black partNo" data-set="0">
                    </div>
                    <div class="form-group mt-3">
                        <label class="form-control border-black">Description</label>
                        <input type="text" class="form-control border-black description" data-set="0">
                    </div>
                    <div class="form-group mt-3">
                        <label class="form-control border-black">Qty</label>
                        <input type="text" class="form-control border-black qty" data-set="0">
                    </div>
                    <div class="form-group mt-3">
                        <label class="form-control border-black">Repair/Reject/To Be Replaced</label>
                        <input type="text" class="form-control border-black lastInput repairStatus" data-set="0">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <br>

    <section>
        <div class="text-center mt-3">
            <button type="button" class="btn btn-primary" onclick="redirectToNextPage()">
                <i class="fa-solid fa-arrow-right"></i><br>
            </button>
        </div>
    </section>

    <script>
        let inputSetCounter = 1; // Counter for tracking the number of input sets

        document.addEventListener('DOMContentLoaded', function () {
            // Initially store data in cookies
            storeInputDataInCookies();

            // Add event listeners for existing inputs to store data in cookies on change
            document.querySelectorAll('.form-control').forEach(function (input) {
                input.addEventListener('input', storeInputDataInCookies);
            });

            document.getElementById('inputContainer').addEventListener('keypress', function (event) {
                if (event.target && event.target.classList.contains('lastInput') && event.key === 'Enter') {
                    event.preventDefault(); // Prevent form submission
                    addInputFields();
                }
            });
        });

        function storeInputDataInCookies() {
            // Collect all inputs and store them in cookies with a unique key for each set
            document.querySelectorAll('.form-group').forEach(function (formGroup) {
                const setId = formGroup.querySelector('input').dataset.set; // Get the data-set attribute

                const partNo = document.querySelector(`.partNo[data-set="${setId}"]`).value || '';
                const description = document.querySelector(`.description[data-set="${setId}"]`).value || '';
                const qty = document.querySelector(`.qty[data-set="${setId}"]`).value || '';
                const repairStatus = document.querySelector(`.repairStatus[data-set="${setId}"]`).value || '';

                // Storing data in cookies with unique keys per set
                document.cookie = `partNo_${setId}=${partNo}; path=/;`;
                document.cookie = `description_${setId}=${description}; path=/;`;
                document.cookie = `qty_${setId}=${qty}; path=/;`;
                document.cookie = `repairStatus_${setId}=${repairStatus}; path=/;`;
            });
        }

        function addInputFields() {
            const container = document.getElementById('inputContainer');

            const newFields = `
                <div class="form-group mt-3">
                    <label class="form-control">Uee Part No</label>
                    <input type="text" class="form-control border-black partNo" data-set="${inputSetCounter}">
                </div>
                <div class="form-group mt-3">
                    <label class="form-control">Description</label>
                    <input type="text" class="form-control border-black description" data-set="${inputSetCounter}">
                </div>
                <div class="form-group mt-3">
                    <label class="form-control">Qty</label>
                    <input type="text" class="form-control border-black qty" data-set="${inputSetCounter}">
                </div>
                <div class="form-group mt-3">
                    <label class="form-control">Repair/Reject/To Be Replaced</label>
                    <input type="text" class="form-control border-black lastInput repairStatus" data-set="${inputSetCounter}">
                </div>
            `;

            container.insertAdjacentHTML('beforeend', newFields);

            // Attach event listeners to the new inputs
            attachInputListeners(inputSetCounter);

            // Increment the set counter for the next batch of inputs
            inputSetCounter++;

            // Store data for new inputs as well
            storeInputDataInCookies();
        }

        function attachInputListeners(setId) {
            // Attach event listeners to the newly created inputs
            document.querySelectorAll(`input[data-set="${setId}"]`).forEach(function (input) {
                input.addEventListener('input', storeInputDataInCookies);
            });
        }

        function redirectToNextPage() {
            window.location.href = "remarks.html";
        }

        // Helper function to retrieve cookies (optional for further use)
        function getCookie(name) {
            let matches = document.cookie.match(new RegExp(
                "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
            ));
            return matches ? decodeURIComponent(matches[1]) : undefined;
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    </script>
</body>

</html>
