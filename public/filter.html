<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filter Page</title>
  <link rel="stylesheet" href="css/matrimony/profile.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!-- Bootstrap JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PQLTG22ZFC"></script>
<script src="js/include.js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-PQLTG22ZFC');
</script>
  <style>
    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      margin-bottom: 20px;
      position: relative;
    }
    .header .back-button {
      position: absolute;
      left: 10px;
      font-size: 24px;
      cursor: pointer;
    }
    .header .title {
      font-size: 24px;
      font-weight: bold;
    }
    .container-wrapper {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }
    .container.mt-4 {
      width: 60%;
    }
    .filter-container {
      width: 35%;
      margin-left: 0px;
      padding: 5px;
      border: 0px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      margin-right: 20px;
    }
    .submit-button-wrapper {
      text-align: center;
      margin-top: 20px;
    }
    #submitButton {
      width: 100%;
      color: whitesmoke;
      background-color: black;
      text-align: center;
    }
    .checkbox-label {
      display: block;
      margin-bottom: 10px;
    }
    .filter-count {
      color: red;
      font-weight: bold;
      margin-left: 10px;
    }
    .filter-section {
      display: none;
    }
    .filter-section.show {
      display: block;
    }
  </style>
</head>
<body>
  <div id="headerPlaceholder"></div>

  <div class="header">
    <div class="back-button" onclick="goBack()"> < </div>
    <div class="title">All Profile</div>
  </div>

  <div class="container-wrapper">
    <div class="container mt-4">
      <div class="list-group" id="filterButtons">
        <!-- Filter Buttons -->
        <a href="#" class="list-group-item list-group-item-action" data-filter="Gender">
          Looking-for <span id="genderCount" class="filter-count">0</span>
        </a>
    
        <a href="#" class="list-group-item list-group-item-action" data-filter="Religion" style="display: none;">
          Religion <span id="religionCount" class="filter-count">0</span>
        </a>
       
        <a href="#" class="list-group-item list-group-item-action" data-filter="Height" style="display: none;">
          Height <span id="heightCount" class="filter-count">0</span>
        </a>
        
        <a href="#" class="list-group-item list-group-item-action" data-filter="Age" style="display: none;">
          Age <span id="ageCount" class="filter-count">0</span>
        </a>
        <br>
        <a href="#" class="list-group-item list-group-item-action" data-filter="State">
          State <span id="stateCount" class="filter-count">0</span>
        </a>
        <br>

        <a href="#" class="list-group-item list-group-item-action" data-filter="Qualification">
          Education <span id="qualificationCount" class="filter-count">0</span>
        </a>

        <a href="#" class="list-group-item list-group-item-action" data-filter="Job" style="display: none;">
          Job/Business <span id="jobCount" class="filter-count">0</span>
        </a>
        <br>

        <a href="#" class="list-group-item list-group-item-action" data-filter="Marital">
          Marital Status <span id="maritalCount" class="filter-count">0</span>
        </a>
        <br>

        <a href="#" class="list-group-item list-group-item-action" data-filter="Follow">
          Deeni Interest <span id="followCount" class="filter-count">0</span>
        </a>
        <br>

        <a href="#" class="list-group-item list-group-item-action" data-filter="Personal" style="display: none;">
          Personal Attributes <span id="personalCount" class="filter-count">0</span>
        </a>
      </div>
      
    </div>

    <div class="filter-container">
      <div id="selectedFilters">
        <!-- Filter options will be displayed here -->
      </div>
    </div>
  </div>
<br>
<br>


  <div class="submit-button-wrapper">
    <button class="Submit" id="submitButton">
      Submit
    </button>
  </div>

  <div id="selectedFiltersDisplay" style="margin-left: 50px; color: black;"></div>

  
  <script src="js/matrimony/scripts.js"></script>
  <script>

function goBack() {
  window.history.back();
}
    document.addEventListener('DOMContentLoaded', () => {
      // Load saved filters and counts on page load
      loadSavedFilters();
  
      // Attach event listeners to filter buttons
      const filterButtons = document.querySelectorAll('#filterButtons a');
      filterButtons.forEach(button => {
        button.addEventListener('click', (event) => {
          event.preventDefault();
          const filter = button.getAttribute('data-filter');
          displayFilterOptions(filter);
        });
      });
  
      // Attach submit button event listener
      document.getElementById('submitButton').addEventListener('click', () => {
        applyFilters();
      });
    });
  
    // Function to display filter options based on the selected filter
    function displayFilterOptions(filter) {
      const selectedFilters = document.getElementById('selectedFilters');
      selectedFilters.innerHTML = ''; // Clear previous filter options
      const filterSection = document.createElement('div');
      filterSection.className = 'filter-section show';
      filterSection.id = filter + 'Buttons';
  
      let filterHtml = '';
      if (filter === 'Gender') {
        filterHtml = `
        <label class="checkbox-label">
  <input type="checkbox" value="male" name="gender" onclick="selectOnlyThis(this)"> Male
</label>
<label class="checkbox-label">
  <input type="checkbox" value="female" name="gender" onclick="selectOnlyThis(this)"> Female
</label>`;
      } else if (filter === 'Religion') {
        filterHtml = `
          <label class="checkbox-label"><input type="checkbox" value="Sunni"> Sunni</label>
          <label class="checkbox-label"><input type="checkbox" value="Syed"> Syed</label>
          <label class="checkbox-label"><input type="checkbox" value="Pathan/Khan"> Pathan</label>
          <label class="checkbox-label"><input type="checkbox" value="Sheikh"> Sheikh</label>
          <label class="checkbox-label"><input type="checkbox" value="Reverted muslims"> Reverted Muslims</label>
          <label class="checkbox-label"><input type="checkbox" value="Others"> Others</label>
        `;
      } else if (filter === 'Height') {
        filterHtml = `
          <label class="checkbox-label"><input type="checkbox" value="4-4.5"> 4 to 4.5 ft</label>
          <label class="checkbox-label"><input type="checkbox" value="4.5-5"> 4.5 to 5 ft</label>
          <label class="checkbox-label"><input type="checkbox" value="5-5.5"> 5 to 5.5 ft</label>
          <label class="checkbox-label"><input type="checkbox" value="5.5-6"> 5.5 to 6 ft</label>
          <label class="checkbox-label"><input type="checkbox" value="6-6.5"> 6 to 6.5 ft</label>
        `;
      } else if (filter === 'Age') {
        filterHtml = `
          <label class="checkbox-label"><input type="checkbox" value="18-25"> 18-25</label>
          <label class="checkbox-label"><input type="checkbox" value="26-35"> 26-35</label>
          <label class="checkbox-label"><input type="checkbox" value="36-45"> 36-45</label>
          <label class="checkbox-label"><input type="checkbox" value="46-60"> 46-60</label>
        `;
      } else if (filter === 'State') {
        filterHtml = `
    <label class="checkbox-label"><input type="checkbox" value="Andhra Pradesh"> Andhra Pradesh</label>
<label class="checkbox-label"><input type="checkbox" value="Arunachal Pradesh"> Arunachal Pradesh</label>
<label class="checkbox-label"><input type="checkbox" value="Assam"> Assam</label>
<label class="checkbox-label"><input type="checkbox" value="Bihar"> Bihar</label>
<label class="checkbox-label"><input type="checkbox" value="Chhattisgarh"> Chhattisgarh</label>
<label class="checkbox-label"><input type="checkbox" value="Goa"> Goa</label>
<label class="checkbox-label"><input type="checkbox" value="Gujarat"> Gujarat</label>
<label class="checkbox-label"><input type="checkbox" value="Haryana"> Haryana</label>
<label class="checkbox-label"><input type="checkbox" value="Himachal Pradesh"> Himachal Pradesh</label>
<label class="checkbox-label"><input type="checkbox" value="Jharkhand"> Jharkhand</label>
<label class="checkbox-label"><input type="checkbox" value="Karnataka"> Karnataka</label>
<label class="checkbox-label"><input type="checkbox" value="Kerala"> Kerala</label>
<label class="checkbox-label"><input type="checkbox" value="Madhya Pradesh"> Madhya Pradesh</label>
<label class="checkbox-label"><input type="checkbox" value="Maharashtra"> Maharashtra</label>
<label class="checkbox-label"><input type="checkbox" value="Manipur"> Manipur</label>
<label class="checkbox-label"><input type="checkbox" value="Meghalaya"> Meghalaya</label>
<label class="checkbox-label"><input type="checkbox" value="Mizoram"> Mizoram</label>
<label class="checkbox-label"><input type="checkbox" value="Nagaland"> Nagaland</label>
<label class="checkbox-label"><input type="checkbox" value="Odisha"> Odisha</label>
<label class="checkbox-label"><input type="checkbox" value="Punjab"> Punjab</label>
<label class="checkbox-label"><input type="checkbox" value="Rajasthan"> Rajasthan</label>
<label class="checkbox-label"><input type="checkbox" value="Sikkim"> Sikkim</label>
<label class="checkbox-label"><input type="checkbox" value="Tamil Nadu"> Tamil Nadu</label>
<label class="checkbox-label"><input type="checkbox" value="Telangana"> Telangana</label>
<label class="checkbox-label"><input type="checkbox" value="Tripura"> Tripura</label>
<label class="checkbox-label"><input type="checkbox" value="Uttar Pradesh"> Uttar Pradesh</label>
<label class="checkbox-label"><input type="checkbox" value="Uttarakhand"> Uttarakhand</label>
<label class="checkbox-label"><input type="checkbox" value="West Bengal"> West Bengal</label>
 `;
      } else if (filter === 'Qualification') {
    filterHtml = `
     <label class="checkbox-label"><input type="checkbox" value="high_school"> High School</label>
<label class="checkbox-label"><input type="checkbox" value="plus_two_puc"> +2 / PUC</label>
<label class="checkbox-label"><input type="checkbox" value="bachelors"> Bachelors</label>
<label class="checkbox-label"><input type="checkbox" value="masters"> Masters</label>
<label class="checkbox-label"><input type="checkbox" value="engineer_mca"> Engineer / MCA</label>
<label class="checkbox-label"><input type="checkbox" value="mbbs"> MBBS</label>
<label class="checkbox-label"><input type="checkbox" value="phd"> PhD</label>
<label class="checkbox-label"><input type="checkbox" value="others"> Others</label>


    `;

} else if (filter === 'Job') {
        filterHtml = `
         <label class="checkbox-label"><input type="checkbox" value="Propriteor"> Propriteor</label>
<label class="checkbox-label"><input type="checkbox" value="Partner"> Partner</label>
<label class="checkbox-label"><input type="checkbox" value="Family"> Family</label>
  `;
      } else if (filter === 'Marital') {
        filterHtml = `
    <label class="checkbox-label"><input type="checkbox" value="Single"> Single</label>
<label class="checkbox-label"><input type="checkbox" value="Divorced"> Divorced</label>
<label class="checkbox-label"><input type="checkbox" value="Widower"> Widower</label>
<label class="checkbox-label"><input type="checkbox" value="Widow"> Widow</label>
<label class="checkbox-label"><input type="checkbox" value="Awaiting Divorce"> Awaiting Divorce</label>
 `;

      } else if (filter === 'Follow') {
        filterHtml = `
         <label class="checkbox-label"><input type="checkbox" value="Moderate Practicing"> Moderate Practicing</label>
<label class="checkbox-label"><input type="checkbox" value="Strictly Practicing"> Strictly Practicing</label>
<label class="checkbox-label"><input type="checkbox" value="Non-Practicing"> Non-Practicing</label>
<label class="checkbox-label"><input type="checkbox" value="Ahle Hadees"> Ahle Hadees</label>
<label class="checkbox-label"><input type="checkbox" value="Dargah fateha"> Dargah fateha</label>
<label class="checkbox-label"><input type="checkbox" value="Tablighi"> Tablighi</label>
<label class="checkbox-label"><input type="checkbox" value="Jamat-e-Islami"> Jamat-e-Islami</label>

        `;
      } else if (filter === 'Personal') {
        filterHtml = `
          <label class="checkbox-label"><input type="checkbox" value="Fair"> Fair</label>
          <label class="checkbox-label"><input type="checkbox" value="Beautiful"> Beautiful</label>
          <label class="checkbox-label"><input type="checkbox" value="Deendar"> Deendar</label>
          <label class="checkbox-label"><input type="checkbox" value="Practising"> Practising</label>
          <label class="checkbox-label"><input type="checkbox" value="Namazi"> Namazi</label>
          <label class="checkbox-label"><input type="checkbox" value="Hijabi"> Hijabi</label>
        `;
      }
      function validateSelection() {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    let isChecked = false;
  
    checkboxes.forEach((checkbox) => {
        if (checkbox.checked) {
            isChecked = true;
        }
    });

    if (!isChecked) {
        alert("Please select at least one criteria");
        return false;  // Prevent further action if no checkbox is selected
    }

    // Proceed with further logic if at least one checkbox is selected
    return true;
}

// Call the validateSelection function when the submit button is clicked
document.querySelector("#submitButton").addEventListener("click", function (e) {
    e.preventDefault();  // Prevent default form submission
    if (validateSelection()) {
        // Proceed with form submission or further logic
        console.log("Proceed with form submission...");
    }
});

      filterSection.innerHTML = filterHtml;
      selectedFilters.appendChild(filterSection);
  
      // Attach change event listeners to checkboxes
      filterSection.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          updateFilterCount(filter);
        });
      });
  
      // Load saved filter options
      loadSavedFilterOptions(filter);
    }
  
    // Function to update the count of selected options for a specific filter
    function updateFilterCount(filter) {
      const checkboxes = document.querySelectorAll(`#${filter}Buttons input[type="checkbox"]`);
      const count = Array.from(checkboxes).filter(checkbox => checkbox.checked).length;
      document.getElementById(`${filter.toLowerCase()}Count`).innerText = count;
  
      // Save the filter options to local storage
      saveFilterOptions(filter);
  
      // Update the selected gender if the Gender filter is updated
      if (filter === 'Gender') {
        selectedGender = Array.from(checkboxes).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value).join(', ');
      }
     
      if (filter === 'State') {
        selectedState = Array.from(checkboxes).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value).join(', ');
      }
      if (filter === 'Follow') {
        selectedFollow = Array.from(checkboxes).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value).join(', ');
      }
      if (filter === 'Qualification') {
        selectedQualification = Array.from(checkboxes).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value).join(', ');
      }
      if (filter === 'Job') {
        selectedJob = Array.from(checkboxes).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value).join(', ');
      }
      if (filter === 'Marital') {
        selectedMarital = Array.from(checkboxes).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value).join(', ');
      }

    }
    
  
    // Function to save filter options to local storage
    function saveFilterOptions(filter) {
      const checkboxes = document.querySelectorAll(`#${filter}Buttons input[type="checkbox"]`);
      const selectedValues = Array.from(checkboxes)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => checkbox.value);
      localStorage.setItem(filter, JSON.stringify(selectedValues));
    }
  
    // Function to load saved filter options
    function loadSavedFilterOptions(filter) {
      const savedOptions = JSON.parse(localStorage.getItem(filter)) || [];
      document.querySelectorAll(`#${filter}Buttons input[type="checkbox"]`).forEach(checkbox => {
        checkbox.checked = savedOptions.includes(checkbox.value);
      });
      updateFilterCount(filter); // Update the count based on saved options
    }
  
    // Function to load saved filters and counts
    function loadSavedFilters() {
      ['Gender', 'Religion', 'Height', 'Age', 'State', 'Qualification', 'Job', 'Marital', 'Follow', 'Personal'].forEach(filter => {
        loadSavedFilterOptions(filter);
        updateFilterCount(filter);
      });
    }
  
   // Function to get token from cookies
function getTokenFromCookies() {
  const name = 'token=';
  const decodedCookie = decodeURIComponent(document.cookie);
  const ca = decodedCookie.split(';');
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) === ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) === 0) {
      return c.substring(name.length, c.length);
    }
  }
  return '';
}

// Function to check login status
function checkLogin() {
  const token = getTokenFromCookies();
  if (!token) {
    // Token not found, redirect to login page
    window.location.href = 'login.html';
  } else {
    // Token found, redirect to the next page
    // This might be the page you want to access
    // window.location.href = 'profileSearch.html';
  }
}

// Check login status on page load
window.onload = function() {
  checkLogin();
}
    // Get the token from cookies
    const authToken = getTokenFromCookies();
  
    // Function to apply filters and fetch data from the API
  // Function to apply filters and fetch data from the API
  function applyFilters() {
  // Prepare the payload dynamically
  const payload = {};

  if (selectedGender) payload.gender = selectedGender;
  if (selectedState) payload.field2 = selectedState;
  if (selectedFollow) payload.field1 = selectedFollow;
  if (selectedQualification) payload.field3 = selectedQualification;
  if (selectedJob) payload.field4 = selectedJob;
  if (selectedMarital) payload.field5 = selectedMarital;

  console.log('Payload:', payload);

  // Check if there's any data to send
  if (Object.keys(payload).length === 0) {
    console.warn('No filters selected. Please select at least one filter.');
    return;
  }

  fetch('https://api.itstrending.in:5001/api/v1/profiles/search_multiple', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': authToken
      
    },
    body: JSON.stringify(payload)
  })
  .then(response => response.json())
  .then(data => {
    console.log('API Response:', data);
    console.log('Payload:', payload);
    // Store the fetched data in session storage
    sessionStorage.setItem('profileData', JSON.stringify(data.data));
    
    // Redirect to the next page
    window.location.href = 'profileSearch.html';
  })
  .catch((error) => {
    console.error('Error during fetch:', error);
  });
}


// Store the fetched data in session storage
sessionStorage.setItem('profileData', JSON.stringify(data.data));
console.log('Data stored in sessionStorage:', data.data); // Debug log

function selectOnlyThis(checkbox) {
  var checkboxes = document.getElementsByName('gender');
  checkboxes.forEach((item) => {
    if (item !== checkbox) item.checked = false;
  });
}


const express = require('express');
const app = express();

// CORS middleware
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*'); // Replace * with your domain if possible
  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
  next();
});

// Other middleware
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Define your API endpoints here
app.get('/api/v1/profiles/get_profile_details', (req, res) => {
  // Your logic for GET request
  res.json({ message: 'GET profile details endpoint' });
});

app.post('/api/v1/profiles/search_multiple', (req, res) => {
  // Your logic for POST request
  res.json({ message: 'POST search multiple profiles endpoint' });
});

// Start the server
const PORT = process.env.PORT || 5000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});



  </script>
  
  

</body>
</html>