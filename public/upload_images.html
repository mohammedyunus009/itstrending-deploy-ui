<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Upload</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- Google tag (gtag.js) -->
     <link rel="stylesheet" href="css/matrimony/malefemale.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PQLTG22ZFC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-PQLTG22ZFC');
</script>
    <style>
        /* Base Styles */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh; /* Ensures full viewport height */
}

header {
    background-color: #333;
    padding: 10px 20px;
    border-bottom: 1px solid #dee2e6;
    text-align: center;
}

.header-title {
    margin: 0;
    font-size: 24px;
    color: white;
}
/* Photo Upload Container */
.photo-upload-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    width: 100%;
    flex: 1; /* Takes available space */
}

/* Photo Upload Grid */
.photo-upload-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    max-width: 800px; /* Adjusted width */
    width: 100%;
    margin-bottom: 20px;
}

/* Photo Upload Box */
.photo-upload-box {
    position: relative;
    width: 100%;
    height: 150px; /* Adjusted height */
    border: 2px solid #ccc;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f9f9f9;
}

/* Photo Upload Button */
.photo-upload-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    cursor: pointer;
    background-color: transparent;
    border: none;
    outline: none;
}

/* Photo Upload SVG Icon */
.photo-upload-button svg {
    width: 40px; /* Adjusted width */
    height: 40px; /* Adjusted height */
    fill: #007bff;
}

/* Photo Upload Label */
.photo-upload-label {
    margin-top: 10px;
}

/* Photo Upload Box Image */
.photo-upload-box img {
    max-width: 100%;
    max-height: 100%;
    object-fit: cover;
    display: block;
}

/* Processing Overlay */
.processing-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Processing Spinner */
.processing-spinner {
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-left: 4px solid #007bff;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    animation: spin 1s linear infinite;
}

/* Keyframes for Spinner */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Delete Button */
.delete-button {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255, 0, 0, 0.7);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    text-align: center;
}

/* Mobile Styles */
@media (max-width: 768px) {
    .photo-upload-grid {
        grid-template-columns: 1fr;
    }

    .photo-upload-box {
        height: 120px; /* Adjusted height */
    }

    .photo-upload-button svg {
        width: 30px;
        height: 30px;
    }

    .photo-upload-label span {
        font-size: 12px;
    }

    .delete-button {
        width: 20px;
        height: 20px;
        font-size: 14px;
    }

    #next-button {
        width: 100%; /* Full width for mobile */
    }
}

/* Button Styles */
#next-button {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #333; /* Updated background color */
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    outline: none;
    width: 100%; /* Full width */
    display: block; /* Ensures the button spans the full width */
    text-align: center; /* Center text */
    margin-top: auto; /* Pushes the button to the bottom */
}

#next-button:hover {
    background-color: #222; /* Slightly darker on hover for better visibility */
}

/* Desktop Styles */
@media (min-width: 769px) {
    #next-button {
        width: 100%; /* Full width for desktop */
    }
}

/* Mobile Styles */
@media (max-width: 768px) {
    .photo-upload-container {
        padding: 10px; /* Reduced padding for smaller screens */
    }

    .photo-upload-grid {
        grid-template-columns: 1fr; /* Single column layout for mobile */
        gap: 8px; /* Reduced gap for better fit */
    }

    .photo-upload-box {
        height: 120px; /* Adjusted height for mobile view */
    }

    .photo-upload-button svg {
        width: 30px; /* Adjusted width for mobile */
        height: 30px; /* Adjusted height for mobile */
    }

    .photo-upload-label span {
        font-size: 12px; /* Smaller font size for mobile */
    }

    .delete-button {
        width: 20px; /* Smaller delete button for mobile */
        height: 20px;
        font-size: 14px; /* Adjusted font size for mobile */
    }

    #next-button {
        padding: 10px; /* Adjusted padding for mobile */
        font-size: 14px; /* Smaller font size for mobile */
        width: 100%; /* Full width for mobile */
    }
}


    </style>
</head>
<body>
    <div class="header">
        <div class="back-button" onclick="goBack()"> &lt; </div>
        <div class="title">Photo Upload</div>
        <div></div>
    </div>
    <div class="photo-upload-container" style="margin: auto;">
        <div class="photo-upload-grid">
            <!-- Photo upload boxes will be dynamically added here -->
        </div>
        <input type="file" id="file-input" style="display: none;" accept="image/*" multiple>
        <button id="next-button" class="btn btn-primary">Next</button>
    </div>
    
    <script>
    const maxPhotos = 2;
    let uploadCounter = 0;
    let imageUrls = {}; // To track the URLs of uploaded images
    
    // Allowed file types and maximum size
    const allowedFileTypes = ['image/jpeg', 'image/png', 'image/gif'];
    const maxFileSizeMB = 5; // Maximum file size in megabytes
    
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
    
    function setCookie(name, value, expires) {
        document.cookie = `${name}=${value}; expires=${expires.toUTCString()}; path=/`;
    }
    
    function deleteCookie(name) {
        document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`;
    }
    
   function createPhotoUploadBox(index) {
    const box = document.createElement('div');
    box.classList.add('photo-upload-box');
    box.setAttribute('data-index', index);

    // Create a div for upload info
    const uploadInfo = document.createElement('div');
    uploadInfo.classList.add('upload-info');
    uploadInfo.innerHTML = `
        <p>Allowed file types: ${allowedFileTypes.join(', ')}</p>
        <p>Maximum file size: ${maxFileSizeMB} MB</p>
    `;
    box.appendChild(uploadInfo);

    const uploadButton = document.createElement('button');
    uploadButton.type = 'button';
    uploadButton.classList.add('photo-upload-button');
    uploadButton.setAttribute('data-index', index);
    uploadButton.innerText = 'Add photo'; // Keep the button text as is for triggering the file input
    box.appendChild(uploadButton);

    const deleteButton = document.createElement('button');
    deleteButton.classList.add('delete-button');
    deleteButton.innerText = 'X';
    deleteButton.addEventListener('click', function() {
        deletePhoto(index);
    });
    box.appendChild(deleteButton);

    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = allowedFileTypes.join(', ');
    fileInput.style.display = 'none'; // Hide file input
    fileInput.addEventListener('change', function(event) {
        handleFileUpload(event.target.files, index);
    });
    box.appendChild(fileInput);

    uploadButton.addEventListener('click', function() {
        fileInput.click(); // Trigger file input click
    });

    // Enable drag and drop functionality
    box.addEventListener('dragover', (e) => {
        e.preventDefault();
        box.classList.add('drag-over');
    });

    box.addEventListener('dragleave', () => {
        box.classList.remove('drag-over');
    });

    box.addEventListener('drop', (e) => {
        e.preventDefault();
        box.classList.remove('drag-over');
        const imageUrl = e.dataTransfer.getData('text/plain');
        swapImages(index, imageUrl);
    });

    return box;
}

    
    function handleFileUpload(files, index) {
        if (!files.length) return;
    
        const file = files[0]; // Only take the first file since one image per box
    
        // Check file type
        if (!allowedFileTypes.includes(file.type)) {
            alert(`Invalid file type. Only ${allowedFileTypes.join(', ')} are allowed.`);
            return;
        }
    
        // Check file size
        if (file.size > maxFileSizeMB * 1024 * 1024) { // Convert MB to bytes
            alert(`File is too large. Maximum size is ${maxFileSizeMB} MB.`);
            return;
        }
    
        // Create image URL and update the cookie
        const imgElement = document.createElement('img');
        const imgUrl = URL.createObjectURL(file);
        imgElement.src = imgUrl;
        imageUrls[index] = imgUrl; // Store the image URL for the box
    
        // Set the image in the box
        const box = document.querySelector(`.photo-upload-box[data-index="${index}"]`);
        box.innerHTML = ''; // Clear previous content
        box.appendChild(imgElement);
        box.appendChild(createDeleteButton(index));
        
        // Update cookie
        setCookie(`image${index}`, imgUrl, new Date(new Date().getTime() + 24 * 60 * 60 * 1000));
        
        // Increase the upload counter
        uploadCounter++;
    
        // Hide the file input if the max photos limit is reached
        if (uploadCounter >= maxPhotos) {
            document.getElementById('file-input').style.display = 'none'; // Hide file input
        }
    }
    
    function swapImages(targetIndex, draggedImageUrl) {
        // Check if the target index already has an image
        const currentImageUrl = imageUrls[targetIndex];
    
        // If there is already an image, swap it with the dragged image
        if (currentImageUrl) {
            // Swap the images
            const sourceIndex = Object.keys(imageUrls).find(index => imageUrls[index] === draggedImageUrl);
            if (sourceIndex !== undefined) {
                imageUrls[targetIndex] = draggedImageUrl; // Set new image URL
                imageUrls[sourceIndex] = currentImageUrl; // Set old image URL to dragged position
    
                // Update the display
                updatePhotoUploadBox(targetIndex, draggedImageUrl);
                updatePhotoUploadBox(sourceIndex, currentImageUrl);
            }
        } else {
            // If the target box is empty, just set the dragged image
            imageUrls[targetIndex] = draggedImageUrl;
            updatePhotoUploadBox(targetIndex, draggedImageUrl);
        }
    }
    
    function updatePhotoUploadBox(index, imageUrl) {
        const box = document.querySelector(`.photo-upload-box[data-index="${index}"]`);
        box.innerHTML = ''; // Clear previous content
        const imgElement = document.createElement('img');
        imgElement.src = imageUrl;
        box.appendChild(imgElement);
        box.appendChild(createDeleteButton(index)); // Add delete button
    }
    
    function createDeleteButton(index) {
        const deleteButton = document.createElement('button');
        deleteButton.classList.add('delete-button');
        deleteButton.innerText = 'X';
        deleteButton.addEventListener('click', function() {
            deletePhoto(index);
        });
        return deleteButton;
    }
    
    function deletePhoto(index) {
        // Remove the image URL from cookies
        deleteCookie(`image${index}`);
        uploadCounter--; // Decrease the upload counter
    
        // Clear the stored image URL
        delete imageUrls[index];
        
        // Clear the display
        const box = document.querySelector(`.photo-upload-box[data-index="${index}"]`);
        box.innerHTML = ''; // Clear the box content
    
        // Show the file input if there is space available
        if (uploadCounter < maxPhotos) {
            document.getElementById('file-input').style.display = 'block'; // Show file input
        }
    }
    
    function initializePhotoUpload() {
        const container = document.querySelector('.photo-upload-grid');
        for (let i = 0; i < maxPhotos; i++) {
            const box = createPhotoUploadBox(i);
            container.appendChild(box);
        }
    }
    
    document.getElementById('file-input').addEventListener('change', function(event) {
        const files = event.target.files;
        for (let i = 0; i < files.length && uploadCounter < maxPhotos; i++) {
            handleFileUpload([files[i]], uploadCounter); // Handle one file at a time
        }
    });
    
    document.getElementById('next-button').addEventListener('click', function() {
        // Redirect to profile2.html
        window.location.href = 'profile2.html';
    });
    
    initializePhotoUpload();
    

const express = require('express');
const app = express();
const path = require('path');

// CORS middleware
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*'); // Replace * with your domain if possible
  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
  next();
});

// Middleware to parse JSON request bodies
app.use(express.json());

// Middleware to serve static files (like your HTML, CSS, JS)
app.use(express.static(path.join(__dirname, 'public'))); // Assumes static files are in the 'public' directory

// Define your API endpoints here
app.get('/login', (req, res) => {
  // Handle API logic here
  res.send('API response');
});

// Example POST endpoint for handling file uploads (you might need 'multer' for handling multipart/form-data)
app.post('/api/v1/profiles/upload_images', (req, res) => {
  // Handle file upload logic here
  res.json({
    status: 'success',
    data: {
      images: ['http://example.com/image1.jpg', 'http://example.com/image2.jpg']
    }
  });
});

// Start your server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server listening on port ${PORT}`);
});


function goBack() {
    window.history.back();
}


function checkLogin() {

    let token = getCookie('token');
        if (!token) {
            alert("User not logged in. Please login.");
            window.location.href = 'login.html';
        }
    }

    window.onload = function() {
        checkLogin();
    }
    </script>
</body>
</html>