<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Matrimonial</title>

    <!-- Bootstrap & Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet">

    <!-- jQuery & Select2 JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

    <style>
        .filter-container {
            margin: 20px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
        }
        .filter-container label {
            font-weight: bold;
        }
        .select2-container {
            width: 100% !important;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center">Matrimonial Profile Filter</h2>

        <div class="filter-container">
            <label>Looking for:</label>
            <input type="radio" id="male" name="gender" value="Male">
            <label for="male">Bride Groom</label>
            <input type="radio" id="female" name="gender" value="Female">
            <label for="female">Bride</label>
        </div>

        <div class="filter-container">
            <label for="yearOfBirth">Year of Birth:</label>
            <select id="yearOfBirth" name="field6"></select>
        </div>

        <div class="filter-container">
            <label for="custom-height">Height:</label>
            <select id="custom-height" name="field30"></select>
        </div>

        <div class="filter-container">
            <label for="marital-status">Marital Status:</label>
            <select id="marital-status" name="field3" required>
                <option value="">Please select</option>
                <option value="Unmarried">Unmarried</option>
                <option value="Divorced">Divorced</option>
                <option value="Widowed">Widowed</option>
            </select>
        </div>

        <div class="filter-container">
            <label for="education">Education:</label>
            <select id="education" name="field2" multiple></select>
        </div>

        <div class="filter-container">
            <label for="profession">Profession:</label>
            <select id="profession" name="field9" multiple></select>
        </div>

        <div class="filter-container">
            <label for="partner-location">Location:</label>
            <select id="partner-location" name="field34" multiple></select>
        </div>
        <div class="filter-container">
          <label for="family-subcaste">Family or Subcaste:</label>
          <select id="family-subcaste" name="field8" multiple></select>
      </div>
       

        <div class="text-center">
            <button class="btn btn-primary" onclick="filterProfiles()">Search</button>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            /** ✅ Populate Year of Birth **/
            let yearDropdown = $("#yearOfBirth");
            yearDropdown.append('<option value="">Select Year</option>');
            for (let year = 2024; year >= 1950; year--) {
                yearDropdown.append(`<option value="${year}">${year} - Age ${2024 - year}</option>`);
            }
            yearDropdown.select2({ placeholder: "Select Year", allowClear: true });

            /** ✅ Populate Height Dropdown (Display Feet & Inches, Store as Decimal) **/
            let heightDropdown = $("#custom-height");
            heightDropdown.append('<option value="">Select Height</option>');
            for (let feet = 4; feet <= 7; feet++) {
                for (let inches = 0; inches < 12; inches += 1) {
                    let displayHeight = `${feet} feet ${inches} inches`;
                    let storedHeight = `${feet}.${inches}`;
                    heightDropdown.append(`<option value="${storedHeight}">${displayHeight}</option>`);
                }
            }
            heightDropdown.select2({ placeholder: "Select Height", allowClear: true });

            /** ✅ Populate Other Dropdowns **/
            const educationOptions = ['PhD', 'Masters', 'Bachelors', 'Diploma', 'High School'];
            const professionOptions = ['Doctor', 'Engineer', 'Teacher', 'Business', 'Government Employee'];
            const locationOptions = ['Delhi', 'Mumbai', 'Bengaluru', 'Hyderabad', 'Chennai', 'Kolkata'];
            const subcasteOptions = ['Syed', 'Pathan/Khan', 'Shaik', 'Reverted Muslims', 'Maimun sait', 'Baig'];

            /** ✅ Populate Select2 Dropdowns **/
            $('#education').select2({ placeholder: "Select Education", allowClear: true, data: educationOptions.map(item => ({ id: item, text: item })), tags: true });
            $('#profession').select2({ placeholder: "Select Profession", allowClear: true, data: professionOptions.map(item => ({ id: item, text: item })), tags: true });
            $('#partner-location').select2({ placeholder: "Select Location", allowClear: true, data: locationOptions.map(item => ({ id: item, text: item })) });
         
            $('#family-subcaste').select2({    placeholder: "Select Family Subcaste",allowClear: true, data: subcasteOptions.map(item => ({ id: item, text: item }))});

          });

        function getCookie(name) {
            let value = `; ${document.cookie}`;
            let parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function filterProfiles() {
            const gender = document.querySelector('input[name="gender"]:checked')?.value;
            const yearOfBirth = document.getElementById('yearOfBirth')?.value.trim();
            const height = document.getElementById('custom-height')?.value.trim();
            const maritalStatus = document.getElementById('marital-status')?.value.trim();
            const education = $('#education').val() || [];
            const profession = $('#profession').val() || [];
            const location = $('#partner-location').val() || [];
           
            const familySubcaste = $('#family-subcaste').val() || [];

            let confirmationMessage = `You have entered the following details:\n\n` +
                                      `Gender: ${gender || "Not selected"}\n` +
                                      `Year of Birth: ${yearOfBirth || "Not selected"}\n` +
                                      `Height: ${height || "Not selected"} (Stored as decimal: ${height})\n` +
                                      `Marital Status: ${maritalStatus || "Not selected"}\n` +
                                      `Education: ${education.length > 0 ? education.join(', ') : "Not selected"}\n` +
                                      `Profession: ${profession.length > 0 ? profession.join(', ') : "Not selected"}\n` +
                                      `Location: ${location.length > 0 ? location.join(', ') : "Not selected"}\n` +
                                      `Family Subcaste: ${familySubcaste || "Not selected"}\n\n` +
                                      `Do you want to proceed with the search?`;

            if (!confirm(confirmationMessage)) return;

            const token = getCookie('token');

            if (!token) {
                alert('Authentication failed. Please login.');
                return;
            }

            const bodyData = { gender, field6: yearOfBirth, field30: height, field3: maritalStatus, field2: education, field9: profession, field34: location, field8: familySubcaste };

            fetch('https://api.itstrending.in:5000/api/v1/profiles/search_multiple', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': token },
                body: JSON.stringify(bodyData)
            }).then(response => response.json())
              .then(data => alert('Search successful!'))
              .catch(error => alert(`Error: ${error.message}`));
        }
    </script>
</body>
</html>