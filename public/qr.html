<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code PDF Generator</title>
    <style>
        #qrcode {
            width: 160px;
            height: 160px;
            margin: 20px auto;
            padding: 10px;
            border: 2px solid #333;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #downloadLink {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div id="downloadLink">
    <a id="pdfLink" href="" target="_blank">
        <div id="qrcode"></div>
    </a>
</div>

<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    async function createPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        const content = `
Invoice Number & Date: ${getCookie('field9') || 'Not provided'}
Customer Name & Details: ${getCookie('field1') || 'Not provided'}
Product Details: ${getCookie('field32') || 'Not provided'}
Vehicle Model & Quantity: ${getCookie('field5') || 'Not provided'}
Date of Installation: ${getCookie('field4') || 'Not provided'}
Rep No: ${getCookie('field2') || 'Not provided'}

Warranty Details:
1) One-year Warranty effective from the purchase date.
2) Warranty covers any manufacturing technical defects excluding breakage.
3) Warranty void if repairing without our consent or warranty seal is broken.
4) The warranty does not cover faults resulting from operation, careless handling, or not following instructions. Also, electric shock cases.
        `;

        // Adding the content to the PDF, starting at position (10, 10)
        const lineHeight = 10;
        const lines = doc.splitTextToSize(content, 180);  // Split text into lines for fitting within the page width
        doc.text(lines, 10, 10 + lineHeight);

        const pdfBlob = doc.output('blob');
        const pdfUrl = URL.createObjectURL(pdfBlob);

        console.log('Generated PDF URL:', pdfUrl); // Log the PDF URL for debugging
        return pdfUrl;
    }

    async function generateQRCode() {
        const pdfUrl = await createPDF();

        // Display the link to download or view the PDF
        const linkElement = document.getElementById('pdfLink');
        linkElement.href = pdfUrl;
        document.getElementById('downloadLink').style.display = 'block';

        // Generate the QR code
        document.getElementById("qrcode").innerHTML = ""; // Clear previous QR code
        new QRCode(document.getElementById("qrcode"), {
            text: pdfUrl,
            width: 160,
            height: 160,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.L
        });
    }

    window.onload = function() {
        generateQRCode();

        // Make an XMLHttpRequest to retrieve and log headers
        var req = new XMLHttpRequest();
        req.open('GET', document.location, true);
        req.send(null);
        req.onload = function() {
            var headers = req.getAllResponseHeaders().toLowerCase();
            console.log('Response Headers:', headers); // Log headers for debugging
        };
    };

    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
        return '';
    }
</script>

</body>
</html>
