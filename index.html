<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PQLTG22ZFC"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!-- Bootstrap JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PQLTG22ZFC');
  </script>
  <title>SIGNUP&SIGNIN</title>
</head>
<style>
  * {
    padding: 0;
    margin: 0;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
  }
  body, html {
    width: 100%;
    height: 100%;
    font-size: 16px;
  }
  body {
    background: white;
  }
  /* General Styling */
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    padding-top: 54px; /* Prevent content from being hidden under the fixed navbar */
  }
  /* Navbar Styling */
  .navbar {
    display: flex;
    width: 100%;
    height: 100px;
    align-items: center;
    background-color: #002d50; /* Main dark blue background */
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
  }
  .navbar-item.left {
    display: flex;
    align-items: center;
    padding-left: 15px;
    width: 100%;
  }
  .navbar-item.left .logo {
    width: 102px;
    margin-right: 15px;
  }
  .company-info {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    flex-grow: 1;
  }
  .company-info img {
    margin-left: 10px;
    width: 30px;
  }
  /* Middle and Right sections */
  .navbar-item.middle,
  .navbar-item.right {
    flex: 0 0 3%;
    height: 100%;
  }
  .navbar-item.middle {
    background-color: #005b66;
  }
  .navbar-item.right {
    background-color: #00bfa6;
  }
  .container1 {
    width: 100%;
    max-width: 400px;
    margin: 50px auto;
    padding: 20px;
    border: 2px solid #00bfa6;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    background: #fff;
  }
  .login-form1 {
    display: flex;
    flex-direction: column;
  }
  .form-heading {
    text-align: center;
    margin-bottom: 20px;
    color: #002d50;
  }
  label {
    margin-bottom: 5px;
    font-weight: bold;
  }
  input {
    margin-bottom: 15px;
    padding: 10px;
    border: 2px solid #00bfa6;
    border-radius: 4px;
  }
  #login {
    background-color: #005b66;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 10px 20px;
    font-size: 20px;
    cursor: pointer;
    display: block;
    margin: 0 auto;
    text-align: center;
    margin-top: 20px;
  }
  #login:hover {
    background-color: #005b66;
  }
  .form-links {
    margin-top: 20px;
    text-align: center;
  }
  .form-links a {
    display: block;
    color: #007bff;
    text-decoration: none;
    font-size: 14px;
    margin: 5px 0;
  }
  .form-links a:hover {
    text-decoration: underline;
  }
  .popup {
    display: none;
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
  }
  .popup-content {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    animation: fadeIn 0.5s;
  }
  .popup-header h2 {
    margin: 0;
  }
  .popup-footer {
    margin-top: 20px;
  }
  .popup-footer button {
    padding: 10px 20px;
    background: #28a745;
    border: none;
    color: #fff;
    border-radius: 5px;
    cursor: pointer;
  }
  .popup-footer button:hover {
    background: #218838;
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .message-container {
    padding: 10px;
    margin-bottom: 20px;
    border-radius: 5px;
    font-size: 16px;
    text-align: center;
    display: none;
  }
  .message-container.success {
    background-color: #4CAF50;
    color: #fff;
  }
  .message-container.error {
    background-color: #f44336;
    color: #fff;
  }
  .loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    z-index: 1000;
  }
  .spinner {
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    border-top: 4px solid #fff;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  input[type="password"] {
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
  }
  /* Navbar links */
  .navbar-links {
    display: flex;
    list-style-type: none;
    gap: 22px;
  }
  .navbar-links a {
    text-decoration: none;
    color: white;
    padding: 8px 11px;
    border-radius: 4px;
    transition: background-color 0.3s;
  }
  /* Mobile View */
  @media (max-width: 768px) {
    .navbar-links {
      flex-direction: column;
      gap: 0px;
    }
    .navbar-item.left {
      flex: 0 0 88%;
      display: flex;
      align-items: center;
      padding-left: 15px;
    }
    .navbar-links li {
      margin-bottom: 0px;
      margin-right: 0px;
    }
  }
  .menu-btn {
    display: none;
    font-size: 30px;
    background: none;
    color: white;
    border: none;
    cursor: pointer;
  }
  @media (max-width: 768px) {
    .navbar-links {
      display: none;
      flex-direction: column;
      position: absolute;
      top: 12px;
      left: 135px;
      width: 50%;
      text-align: center;
      background-color: #002d50;
    }
    .navbar-links.show {
      display: flex;
      margin-top: -10px;
    }
    .menu-btn {
      display: block;
      margin-bottom: 50px;
    }
  }
  /* Popup styling */
  .popup-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff;
    padding: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    z-index: 9999;
    width: 300px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .popup-content h3 {
    font-size: 20px;
    color: #333;
    margin-bottom: 10px;
  }
  .popup-content p {
    font-size: 16px;
    color: #666;
    margin-bottom: 20px;
  }
  .popup-btn {
    background-color: #333;
    color: #fff;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .popup-btn:hover {
    background-color: #555;
  }
  /* Dimmed background effect */
  .popup-container::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: -1;
  }
</style>

<body>

  <header class="navbar">
    <div class="navbar-item left">
      <img src="img/Alisom Logo .png" alt="Logo" class="logo">
    </div>
    <div>
      <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
      <ul class="navbar-links">
        <li><a href="index.html">Login</a></li>
        <li><a href="Add_client.html">Add Client</a></li>
        <li><a href="Due-Payment.html">Due Payment</a></li>
        <li><a href="search.html">Search</a></li>
        <li><a href="po-and-customername.html">Name &amp; PO Number</a></li>
      </ul>
    </div>
    <div class="navbar-item middle"></div>
    <div class="navbar-item right"></div>
  </header>

  <br>
  <br>

  <div class="container1">
    <!-- Message container -->
    <div id="messageContainer" class="message-container"></div>
    
    <!-- Loading animation -->
    <div id="loadingContainer" class="loading-container" style="display: none;">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>
    
    <form action="#" class="login-form1" id="loginForm1">
      <h2 class="form-heading">Login</h2>
      <label for="email">Email</label>
      <input type="email" name="email" id="email" placeholder="Email" required>
      <!-- Password field with eye icon for visibility toggle -->
      <label for="password">Password</label>
      <div style="position: relative;">
        <input type="password" name="password" id="password" placeholder="Password" required style="padding-right: 40px;">
        <span onclick="togglePassword('password')" 
              style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">
            üëÅÔ∏è
        </span>
      </div>
      <button type="submit" id="login">Login</button>
      <div class="form-links">
        <a href="signup.html" id="create-account">Create Account</a>
        <a href="forgotpssword.html" id="forgot-password">Forgot Password?</a>
      </div>
    </form>
  </div>

  <script>
    // Toggle mobile menu
    function toggleMenu() {
      const navbarLinks = document.querySelector('.navbar-links');
      navbarLinks.classList.toggle('show');
    }
  </script>
  <script>
    // Toggle password visibility
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      if (input.type === "password") {
        input.type = "text";
      } else {
        input.type = "password";
      }
    }
  </script>
  <script>
    // Define cookie functions
    function getCookie(name) {
      let nameEQ = name + "=";
      let decodedCookies = decodeURIComponent(document.cookie);
      let ca = decodedCookies.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(nameEQ) === 0) {
          return c.substring(nameEQ.length, c.length);
        }
      }
      return null;
    }

    function setCookie(name, value, days) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      document.cookie = `${name}=${value}; expires=${date.toUTCString()}; path=/`;
    }

    function clearCookie(name) {
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
    }

    // Check if the token is expired (after 12 hours)
    function checkTokenExpiry() {
      const loginTime = localStorage.getItem("loginTime");
      const twelveHours = 12 * 60 * 60 * 1000; // 12 hours in milliseconds
      if (loginTime && Date.now() - parseInt(loginTime) > twelveHours) {
        clearCookie("email");
        clearCookie("token");
        localStorage.removeItem("loginTime");
        window.location.href = "index.html";  // Redirect to login page
      }
    }

    // Direct access check
    function isDirectAccess() {
      return document.referrer === "";
    }

    // Check login status and show logout popup if already logged in
    function checkLoginStatus() {
      const email = getCookie("email");
      const token = getCookie("token");
      if (email && token) {
        showLogoutPopup();
      }
    }

    // Show logout confirmation popup
    function showLogoutPopup() {
      const popup = document.createElement("div");
      popup.className = "popup-container";
      popup.innerHTML = `
          <div class="popup-content">
              <h3>You are already logged in!</h3>
              <p>Do you want to log out?</p>
              <button id="logoutBtn" class="popup-btn">Logout</button>
              <button id="cancelBtn" class="popup-btn">Cancel</button>
          </div>
      `;
      document.body.appendChild(popup);
      document.getElementById("logoutBtn").addEventListener("click", function() {
        clearCookie("email");
        clearCookie("token");
        localStorage.removeItem("loginTime");
        location.reload();
      });
      document.getElementById("cancelBtn").addEventListener("click", function() {
        document.body.removeChild(popup);
      });
    }

    // Show token expired popup
    function showTokenExpiredPopup() {
      const popup = document.createElement("div");
      popup.className = "popup-container";
      popup.innerHTML = `
          <div class="popup-content">
              <h3>Token Expired!</h3>
              <p>Your session has expired. Please log in again.</p>
              <button id="loginAgainBtn" class="popup-btn">Login Again</button>
          </div>
      `;
      document.body.appendChild(popup);
      document.getElementById("loginAgainBtn").addEventListener("click", function() {
        window.location.href = "index.html";
      });
    }

    // Override console.log to detect 401 errors
    const originalConsoleLog = console.log;
    console.log = function(message) {
      if (message && message.includes("401")) {
        showTokenExpiredPopup();
      }
      originalConsoleLog.apply(console, arguments);
    };

    // --- New: Function to fetch profile details and check token validity ---
    async function fetchProfileDetails(profileId) {
      try {
        const token = getCookie("token");
        const headers = new Headers();
        headers.append("Content-Type", "application/json");
        headers.append("Authorization", token); // Adjust if "Bearer" prefix is needed
        const response = await fetch(`https://api2.itstrending.in/api/v1/profile/${profileId}`, {
          method: "GET",
          headers: headers
        });
        const data = await response.json();
        if (data.message === "The provided authorization token is invalid") {
          window.location.href = "index.html";  // Redirect to login page if token is invalid
          return null;
        }
        return data;
      } catch (error) {
        console.error("Error fetching profile details:", error);
        window.location.href = "index.html";
      }
    }

    // Example usage: Replace '12345' with the actual profile ID
    fetchProfileDetails("12345").then(profile => {
      if (profile) {
        console.log("Profile details:", profile);
        // Do something with profile details...
      }
    });

    // Combine window.onload to run all checks
    window.onload = function() {
      if (isDirectAccess()) {
        let email = getCookie("email");
        let token = getCookie("token");
        if (email && token) {
          window.location.href = "index.html";
          return;
        }
      }
      checkTokenExpiry();
      checkLoginStatus();
    };
  </script>

  <script src="js/login.js"></script>
  
  <!--
  The following Express server code should be in a separate file (e.g., server.js) on your Node server.
  It is included here only as a reference and should NOT run on the client side.
  
  const express = require('express');
  const app = express();
  const cors = require('cors');
  const bodyParser = require('body-parser');
  
  app.use(cors());
  app.use(bodyParser.json());
  
  app.use((req, res, next) => {
    res.header('Access-Control-Allow-Origin', '*');
    res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
    next();
  });
  
  app.post('/api/v1/auth/signup', (req, res) => {
    const { email, firstname, lastname, password } = req.body;
    res.json({ success: true, message: 'Signup successful' });
  });
  
  app.post('/api/v1/auth/login', (req, res) => {
    const { email, password } = req.body;
    const token = 'example-token';
    res.json({ success: true, data: { token } });
  });
  
  app.post('/api/v1/auth/reset-password', (req, res) => {
    const { email } = req.body;
    res.json({ success: true, message: 'Password reset link sent' });
  });
  
  const PORT = process.env.PORT || 3000;
  app.listen(PORT, () => {
    console.log(`Server listening on port ${PORT}`);
  });
  -->
</body>
</html>
